<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>View - ìkókó</title>
  <link rel="stylesheet" href="/static/css/base.css" />
  <link rel="stylesheet" href="/static/css/flashcard.css" />
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.4/build/qrcode.min.js"></script>
  <style>
    .owner-banner {
      text-align: center;
      color: var(--text-muted);
      font-size: 0.95rem;
      margin-bottom: 1rem;
    }
    .guest-cta {
      text-align: center;
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 0.75rem 1.25rem;
      max-width: 480px;
      margin: 1.5rem auto 0;
      font-size: 0.95rem;
      color: var(--text-muted);
    }
    .guest-cta a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }
    .guest-cta a:hover {
      text-decoration: underline;
    }
    .guest-toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--bg-card);
      color: var(--text);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 0.75rem 1.25rem;
      font-size: 0.95rem;
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
      opacity: 0;
      transition: opacity 0.3s, transform 0.3s;
      z-index: 1000;
      text-align: center;
    }
    .guest-toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
    .guest-toast a {
      color: var(--accent);
      font-weight: 600;
      text-decoration: none;
    }
    .guest-toast a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <span class="logo">ìkókó</span>
    <div class="nav-links">
      <a href="/dashboard.html" id="nav-dashboard">Dashboard</a>
      <a href="/add.html" id="nav-add">Add New</a>
      <a href="/recent.html" id="nav-recent">Recent</a>
      <a href="/analytics.html" id="nav-analytics">Analytics</a>
      <a href="/profile.html" id="nav-profile">Profile</a>
      <button id="theme-toggle" class="theme-toggle"></button>
      <button id="logout-btn" class="btn-logout">Logout</button>
      <a href="/login.html" id="nav-login" class="btn btn-outline" style="display:none;">Log in</a>
      <a href="/register.html" id="nav-register" class="btn btn-primary" style="display:none;">Register</a>
    </div>
  </nav>

  <main class="app">
    <h1>Ìkókó Card</h1>
    <div id="owner-banner" class="owner-banner" style="display:none;"></div>

    <!-- Guest CTA banner -->
    <div id="guest-cta" class="guest-cta" style="display:none;">
      <p>
        <a href="/login.html" id="cta-login">Log in</a> or
        <a href="/register.html" id="cta-register">register</a>
        to play audio, download cards, react, and comment.
      </p>
    </div>

    <!-- Unauthorized state (shown when card is not shared) -->
    <div id="unauthorized-state" class="unauthorized-state" style="display:none;">
      <div class="unauthorized-card">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
          <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
        </svg>
        <h2>This card hasn't been shared with you</h2>
        <p>The owner hasn't enabled sharing for this card yet.</p>
        <a href="/dashboard.html" class="btn btn-primary">Go to Dashboard</a>
      </div>
    </div>

    <section class="card-stage">
      <div id="flashcard-container"></div>
    </section>

    <div class="action-bar">
      <button id="share-btn" class="btn btn-primary">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>
        Share
      </button>
    </div>

    <!-- Engagement: Reactions + Comments -->
    <div id="engagement-section" class="engagement-section" style="display:none;">
      <div class="engagement-card">
        <div class="reaction-toggle-row">
          <button type="button" id="reaction-toggle" class="reaction-toggle-btn" title="React">
            <span class="reaction-toggle-icon">&#128578;</span> React
          </button>
        </div>
        <div class="reaction-scroll-wrap" id="reaction-scroll-wrap" style="display:none;">
          <button type="button" class="reaction-scroll-arrow reaction-scroll-left" id="reaction-scroll-left">&#8249;</button>
          <div class="reaction-bar" id="reaction-bar"></div>
          <button type="button" class="reaction-scroll-arrow reaction-scroll-right" id="reaction-scroll-right">&#8250;</button>
        </div>
        <div class="engagement-divider"></div>
        <div class="comments-list" id="comments-list"></div>
        <form id="comment-form" class="comment-form">
          <textarea id="comment-text" placeholder="Leave a comment..." rows="2"></textarea>
          <button type="submit" class="send-btn" title="Send comment">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </form>
        <div id="comment-status" class="comment-status"></div>
      </div>
    </div>

    <!-- Share modal -->
    <div id="share-modal" class="modal-overlay" style="display:none">
      <div class="modal share-modal">
        <h3>Share Ìkókó Card</h3>
        <div id="share-toggle-row" class="share-toggle-row" style="display:none;">
          <label class="share-switch">
            <input type="checkbox" id="share-toggle-input" />
            <span class="share-slider"></span>
          </label>
          <span id="share-toggle-label" class="share-toggle-label">Sharing is off</span>
        </div>
        <div class="share-link-row">
          <input type="text" id="share-link-input" readonly />
          <button id="copy-link-btn" class="btn btn-outline">Copy</button>
        </div>
        <div id="qr-container" class="qr-container"></div>
        <div class="modal-actions">
          <button id="native-share-btn" class="btn btn-primary" style="display:none">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:4px"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/><polyline points="16 6 12 2 8 6"/><line x1="12" y1="2" x2="12" y2="15"/></svg>
            Share
          </button>
          <button id="share-modal-close" class="btn btn-outline">Close</button>
        </div>
      </div>
    </div>
  </main>

  <script src="/static/js/theme.js"></script>
  <script src="/static/js/flashcard.js"></script>
  <script>
    // Logout handler
    document.getElementById("logout-btn")?.addEventListener("click", async () => {
      await fetch("/api/auth/logout", { method: "POST", credentials: "include" });
      window.location.href = "/login.html";
    });
  </script>
</body>
</html>
